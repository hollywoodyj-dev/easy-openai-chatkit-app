generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String   @id @default(cuid())
  email         String   @unique
  country       String?
  passwordHash  String? // Optional for OAuth users
  name          String? // For OAuth users
  oauthProvider String? // "google", "facebook", "x", or null for email/password
  oauthId       String? // OAuth provider's user ID
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  subscriptions Subscription[]

  @@unique([oauthProvider, oauthId])
}

model Subscription {
  id                     String                @id @default(cuid())
  user                   User                  @relation(fields: [userId], references: [id])
  userId                 String
  status                 SubscriptionStatus
  plan                   SubscriptionPlan?
  platform               SubscriptionPlatform?
  trialEndsAt            DateTime?
  currentPeriodStart     DateTime?
  currentPeriodEnd       DateTime?
  externalSubscriptionId String?
  createdAt              DateTime              @default(now())
  updatedAt              DateTime              @updatedAt
}

enum SubscriptionStatus {
  trialing
  active
  canceled
  expired
}

enum SubscriptionPlan {
  monthly
  yearly
}

enum SubscriptionPlatform {
  google_play
  app_store
  stripe_web
}
